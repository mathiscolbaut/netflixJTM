{% extends 'base.html.twig' %}

{% block title %}Inscription{% endblock %}

{% block body %}
    <div class="container my-5">
        <h2 class="text-center mb-4">Créer un compte</h2>
        <div class="row justify-content-center">
            <div class="col-md-6 col-lg-4">
                <div class="card shadow-lg p-4" style="border-radius: 15px; background-color: #f8f9fa;">
                    <form id="signupForm">
                        <div class="mb-3">
                            <label for="username" class="form-label">Nom d'utilisateur</label>
                            <input type="text" id="username" class="form-control form-control-lg" placeholder="Entrez votre nom d'utilisateur" style="border-radius: 10px; border: 1px solid #ccc; padding: 10px;">
                        </div>

                        <div class="mb-3">
                            <label for="email" class="form-label">Adresse Email</label>
                            <input type="email" id="email" class="form-control form-control-lg" placeholder="Entrez votre adresse email" style="border-radius: 10px; border: 1px solid #ccc; padding: 10px;">
                        </div>

                        <div class="mb-3">
                            <label for="password" class="form-label">Mot de passe</label>
                            <input type="password" id="password" class="form-control form-control-lg" placeholder="Créez un mot de passe" style="border-radius: 10px; border: 1px solid #ccc; padding: 10px;">
                        </div>

                        <div class="text-center">
                            <button type="submit" class="btn btn-primary btn-lg w-100" style="border-radius: 10px; background-color: #007bff; border-color: #007bff;">S'inscrire</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
       document.querySelector('#signupForm').addEventListener('submit', function(event) {
            event.preventDefault();  // Empêcher la soumission classique du formulaire

            let usernameField = document.querySelector('#username');
            let emailField = document.querySelector('#email');
            let passwordField = document.querySelector('#password');

            if (usernameField && emailField && passwordField) {
                let username = usernameField.value;
                let email = emailField.value;
                let password = passwordField.value;

                // Envoyer la requête API
                fetch('http://127.0.0.1:8086/signup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: username,
                        email: email,
                        password: password
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        // Si la réponse n'est pas OK, rejeter avec le message d'erreur
                        return response.json().then(errorData => {
                            throw new Error(errorData.detail || 'Erreur inconnue');
                        });
                    }
                    return response.json();  // Si la réponse est OK, continuer normalement
                })
                .then(data => {
                    alert('Inscription réussie');
                })
                .catch(error => {
                    alert('Erreur lors de l\'inscription: ' + error.message);
                });
            } else {
                alert('Il manque des champs dans le formulaire');
            }
        });

    </script>
{% endblock %}
